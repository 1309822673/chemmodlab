---
title: "chemmodlab Quickstart Tutorial "
author: "Jeremy Ash"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, fig.height=6, fig.width=6, cache=T)
```

## Installation

Use the code below to install the package.  Since you are installing from source, you will
need to install the package dependencies manually. This will be done automatically once
this is accepted by CRAN.

```{r install package, eval=F}

install.packages(c("class", "e1071", "elasticnet", "foreach", "lars", "MASS",
                   "nnet", "pROC", "randomForest", "rpart", "tree", "pls"))

install.packages("path/to/chemmodlab_0.0.0.9000.tar.gz",
                 repos = NULL, type = "source")
```

First we construct the data set.  The data should be a a data frame containing an (optional) ID column, a response column, and descriptor columns. The columns should be provide in this order.  

First, we load in the response variable (with ID column).  The data is from a cytotoxicity assay conducted by the Scripps Research Institute Molecular Screening Center. There are 3,286 compounds, with 50 being active. Visit [here](http://pubchem.ncbi.nlm.nih.gov/assay/assay.cgi?aid=364) for more details.

The response is a binary variable indicating whether the compound is active or not. At the moment chemmodlab only supports responses that are binary (represented as a numeric vector with 0 or 1 values) or continuous.

## Data Preprocessing

```{r response}
data <- read.csv("AID_364_response.csv")
head(data)
```

Next we add two descriptor sets to the data frame. At the moment, only numeric descriptors are supported.  We store the number of descriptors in each descriptor set, as this will be used to parse the data frame later.  

```{r descriptors}
desc.lengths <- c()
d <- read.csv("BurdenNumbers.csv")
head(d[, 1:5])
data <- cbind(data, d[-1])
desc.lengths <- c(desc.lengths, ncol(d[-1]))

d <- read.csv("Pharmacophores.csv")
head(d[, 1:6])
data <- cbind(data, d[-1])
desc.lengths <- c(desc.lengths, ncol(d[-1]))

dim(data)
```

For this example, we make the data set smaller so the model fitting will run faster.

```{r}
aid364 <- data[1:500, ]
```


## Model Fitting

The data is ready to analyze.  We use the default set of models, number of cross
validation folds, etc.  See `?ModelTrain` for more details.  In all the output, 
we will name the descriptor sets "BurdenNumbers" and "Pharmacophores".  The function 
will complain about some colinear variables, do not worry about this at the moment.

```{r fit model code, R.options=list(max.print=10), eval = F}
library(chemmodlab)
cml <- ModelTrain(aid364, ids = T, xcol.lengths = desc.lengths,
                  des.names = c("BurdenNumbers", "Pharmacophores"))
```

```{r fit model, warning=F, cache=TRUE, include=FALSE, R.options=list(max.print=10)}
cml <- ModelTrain(aid364, ids = T, xcol.lengths = desc.lengths,
                  des.names = c("BurdenNumbers", "Pharmacophores"))
```

## Comparison of Model Performance
###Accumulation Curves

Next we generate the series of accumulation curves assessing the model fits for all
CV splits and descriptor set combinations.  See `?plot.chemmodlab` for more details:

```{r accumulation curves}
plot(cml, splits = 1, models = c("NNet", "KNN"))
```

### Multiple Comparisons Plots

Finally, we compare model performance with the multiple comparisons plot.   Here we are using the default model assessment measure (intial enhancement at 300 tests).^[I am aware that while the plots look good in this vignette, the plotting window in the user's r environment needs to be quite large for these plots to be visible.  I am working on improving this at the moment.]  See
`?CombineSplits` for more information

```{r combine splits IE}
CombineSplits(cml)
```

We can also assess models using a number of other assessment measures

```{r combine splits others}
CombineSplits(cml, metric = "error rate")
CombineSplits(cml, metric = "sensitivity")
CombineSplits(cml, metric = "specificity")
CombineSplits(cml, metric = "auc")
```
